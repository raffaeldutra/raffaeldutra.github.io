# Rafael Dutra
sudo: required

services:
  - docker

branches:
  only:
  - develop

before_install:
  - mkdir -p public/resume

script:
  - docker build --no-cache -t raffaeldutra/docker-gohugo .
  - docker run -it -v $(pwd):/src -v $(pwd)/public:/src/public raffaeldutra/docker-gohugo
  - curl
    --form input_files[]=@content/page/cv/resume.md
    --form from=markdown
    --form to=pdf
    http://c.docverter.com/convert > public/resume/rafael-dutra-resume.pdf
  - curl
    --form input_files[]=@content/page/cv/resume.pt-br.md
    --form from=markdown
    --form to=pdf
    http://c.docverter.com/convert > public/resume/rafael-dutra-resume.pt-br.pdf

deploy:
  name: "rafaeldutra.me deployment"
  provider: pages
  local_dir: public
  skip_cleanup: true
  github_token: $GITHUB_TOKEN
  keep_history: true
  verbose: true
  target_branch: master
  on:
    branch: develop
  fqdn: rafaeldutra.me

dist: trusty
addons:
  chrome: stable
before_install:
  - # start your web application and listen on `localhost`
  - google-chrome-stable --headless --disable-gpu --remote-debugging-port=9222 https://rafaeldutra.me &
  â‹®
